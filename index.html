<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Thought Tree</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: sans-serif;
    }
    #menu {
      position: fixed;
      top: 10px;
      left: 10px;
      background: #eee;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    #seedInput {
      width: 200px;
      padding: 4px;
    }
    .node {
      position: absolute;
      padding: 10px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
      cursor: pointer;
      z-index: 10;
    }
    .node button {
      font-size: 12px;
      margin-left: 6px;
    }
    .option-button {
      display: block;
      margin-top: 4px;
      font-size: 13px;
    }
    svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }
  </style>
</head>
<body>
  <div id="menu">
    <input type="text" id="seedInput" placeholder="Enter your seed idea here">
    <button onclick="placeSeed()">Plant</button>
    <button onclick="saveTree()">Save</button>
  </div>
  <svg id="lines"></svg>
  <div id="canvas"></div>

  <script>
    const directions = {
      "Expand options?": [0, -150],
      "Think deeper?": [150, 0],
      "Use imagination?": [0, 150],
      "Consider counterarguments?": [-150, 0],
      "Add new ideas?": [60, 60]
    };

    const mayoiPrompts = [
      "What else could you choose?",
      "If you flipped the premise, what would change?",
      "Is there an opposite direction worth exploring?",
      "What's at the root of this idea?",
      "Why do you think this matters to you?",
      "What could be driving this under the surface?",
      "Imagine a future where this idea plays out — what happens?",
      "How would someone else see this same situation?",
      "If this were fiction, what would the character do?",
      "What would someone disagree with you about here?",
      "Are there hidden assumptions you're making?",
      "If you challenged yourself, what would you ask?",
      "Is there another concept or field this reminds you of?",
      "What’s one more angle to explore?",
      "Can you make a new question from this?"
    ];

    const connections = [];

    function placeSeed() {
      const text = document.getElementById("seedInput").value;
      if (!text) return;

      const canvas = document.getElementById("canvas");
      const x = window.innerWidth / 2;
      const y = window.innerHeight / 2;

      const seed = createNode(text, x, y);
      canvas.appendChild(seed);
      setTimeout(() => updateLines(), 0);
    }

    function createNode(text, x, y, parent = null) {
      const div = document.createElement("div");
      div.className = "node";
      div.style.left = `${x}px`;
      div.style.top = `${y}px`;
      div.draggable = true;

      const span = document.createElement("span");
      span.className = "node-text";
      span.textContent = text;
      div.appendChild(span);

      attachMayoiButton(div);

      div.addEventListener("click", (e) => {
        e.stopPropagation();
        showOptionMenu(div, div.offsetLeft, div.offsetTop);
      });

      div.addEventListener("dragstart", (e) => {
        e.dataTransfer.setData("text/plain", null);
        div.startX = e.clientX - div.offsetLeft;
        div.startY = e.clientY - div.offsetTop;
      });

      div.addEventListener("dragend", (e) => {
        div.style.left = `${e.clientX - div.startX}px`;
        div.style.top = `${e.clientY - div.startY}px`;
        updateLines();
      });

      div.nodeId = Math.random().toString(36).substr(2, 9);
      div.parent = parent;
      if (parent) connections.push([parent, div]);

      return div;
    }

    function attachMayoiButton(div) {
      const btn = document.createElement("button");
      btn.textContent = "\uD83D\uDCAC";
      btn.title = "Prompt a new thought";
      btn.onclick = (e) => {
        e.stopPropagation();
        const msg = mayoiPrompts[Math.floor(Math.random() * mayoiPrompts.length)];
        alert("\uD83D\uDCAC " + msg);
      };
      div.appendChild(btn);
    }

    function showOptionMenu(parentDiv, baseX, baseY) {
      const existingMenu = document.getElementById("optionMenu");
      if (existingMenu) existingMenu.remove();

      const menu = document.createElement("div");
      menu.id = "optionMenu";
      menu.style.position = "absolute";
      menu.style.left = `${baseX + 20}px`;
      menu.style.top = `${baseY + 20}px`;
      menu.style.background = "white";
      menu.style.border = "1px solid #aaa";
      menu.style.padding = "10px";
      menu.style.borderRadius = "8px";
      menu.style.boxShadow = "2px 2px 8px rgba(0,0,0,0.2)";
      menu.style.zIndex = 100;

      for (const [label, offset] of Object.entries(directions)) {
        const btn = document.createElement("button");
        btn.className = "option-button";
        btn.textContent = label;
        btn.onclick = () => {
          const userInput = prompt(label + " (180 characters max)");
          if (userInput && userInput.length <= 180) {
            const newX = parentDiv.offsetLeft + offset[0];
            const newY = parentDiv.offsetTop + offset[1];
            const newNode = createNode(userInput, newX, newY, parentDiv);
            document.getElementById("canvas").appendChild(newNode);
            setTimeout(() => updateLines(), 0);
          } else if (userInput) {
            alert("Please limit your input to 180 characters.");
          }
          menu.remove();
        };
        menu.appendChild(btn);
      }
      document.body.appendChild(menu);
    }

    function updateLines() {
      const svg = document.getElementById("lines");
      svg.innerHTML = "";
      connections.forEach(([from, to]) => {
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        const x1 = from.offsetLeft + from.offsetWidth / 2;
        const y1 = from.offsetTop + from.offsetHeight / 2;
        const x2 = to.offsetLeft + to.offsetWidth / 2;
        const y2 = to.offsetTop + to.offsetHeight / 2;
        line.setAttribute("x1", x1);
        line.setAttribute("y1", y1);
        line.setAttribute("x2", x2);
        line.setAttribute("y2", y2);
        line.setAttribute("stroke", "#333");
        line.setAttribute("stroke-width", "2");
        svg.appendChild(line);
      });
    }

    function saveTree() {
      const nodes = Array.from(document.getElementsByClassName("node")).map(node => {
        const text = node.querySelector(".node-text")?.textContent || "";
        return {
          text,
          x: node.offsetLeft,
          y: node.offsetTop,
          parentId: node.parent?.nodeId || null,
          nodeId: node.nodeId
        };
      });
      localStorage.setItem("thought_tree", JSON.stringify(nodes));
      alert("Saved!");
    }

    document.addEventListener("click", () => {
      const existingMenu = document.getElementById("optionMenu");
      if (existingMenu) existingMenu.remove();
    });
  </script>
</body>
</html>
